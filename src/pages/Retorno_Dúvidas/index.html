<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css"
    />

    <title>Fit Tracker</title>
    <!-- Link Css -->
    <link rel="stylesheet" href="./styles.css" />
    <!-- Link Css Global -->
    <link rel="stylesheet" href="../../styles/global.css" />
  </head>

  <body>
    <header>
      <div class="item_header">
        <img src="../../assets/logo.svg" alt="Logo" />
      </div>
      <div class="item_header" id="boas_vindas">
        <h2 id="header_treinador"></h2>
      </div>
      <div class="item_header" id="duvidas_conta_logout">
        <a href="../Principal_trainner/index.html">Home</a>
        <a href="../login/index.html"> Sair</a>
      </div>
    </header>
    <main>
      <h2 style="text-align: center">
        <b id="nome_aluno"></b>
      </h2>
      <div class="inicio">
        <h3>Dúvidas:</h3>
        <div class="duvida1">
          <h4 id="assunto" style="padding-left: 15px; padding-top: 3px"></h4>
        </div>
      </div>
      <div class="duvida2">
        <p id="mensagem" style="word-break: break-word"></p>
        <div class="box2">
          <textarea
            id="resposta"
            name="resposta"
            rows="6"
            style="width: 80%; height: 100px"
          ></textarea>
        </div>
        <div class="button">
          <button
            onclick="setDuvida()"
            type="button"
            class="btn btn-lg rounded-pill"
            style="
              padding: 10px 30px;
              background-color: rgb(50, 217, 50);
              color: white;
              border: 0;
              border-radius: 210px;
            "
          >
            Salvar
          </button>
        </div>
      </div>
    </main>
    <footer>
      <div class="information_footer">
        <p><b>Sobre nós</b></p>
        <a href="../QuemSomosPage/index.html">Quem somos?</a>
      </div>
      <div class="information_footer">
        <p><b>Contatos</b></p>
        <a>fittracker@gmail.com</a>
        <a>(31)99145-6032</a>
      </div>
      <div id="div_redes_sociais">
        <p><b>Nossas redes sociais</b></p>
        <a href="https://www.facebook.com/"><i class="bi bi-facebook"></i></a>
        <a href="https://www.twitter.com/"><i class="bi bi-twitter"></i></a>
        <a href="https://www.instagram.com/"><i class="bi bi-instagram"></i></a>
      </div>
    </footer>
  </body>
</html>
<script src="script.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="jquery-3.6.4.min.js"></script>
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get("id");
  const nome = urlParams.get("nome");
  const assunto = urlParams.get("assunto");

  $(document).ready(function () {
    $("#nome_aluno").html("Aluno: " + nome);
    alunos_professor();
    getDuvida();
  });

  var get_aluno = [];
  var get_aluno2 = [];
  function alunos_professor() {
    $.ajax({
      method: "GET",
      url: `http://localhost:3000/usuarios`,
      success: function (data) {
        data.forEach((value) => {
          if (value.codigo_treinador == null && value.id == id) {
            $("#header_treinador").html(
              "Seja bem vindo, Treinador(a) " + value.nome
            );
          }
          if (
            value.codigo_treinador != null &&
            parseInt(value.codigo_treinador) == id
          ) {
            get_aluno.push(value);
          }
        });
        return true;
      },
      error: function (xhr, status, error) {
        alert(
          "Erro ao conectar com o servidor. Por favor tente novamente mais tarde."
        );
        console.log(xhr, status, error);
      },
    });
  }

  function getDuvida() {
    $.ajax({
      method: "GET",
      url: `http://localhost:3000/tipo_informacao`,
      success: function (data) {
        data.forEach((value) => {
          if (String(nome) == value.NOME_ALUNO && value.TP_INFORMACAO == 1) {
            // $("#resposta").val(value.mensagem);
            $("#assunto").html(assunto);
          }
        });
        return true;
      },
      error: function (xhr, status, error) {
        alert(
          "Erro ao conectar com o servidor. Por favor tente novamente mais tarde."
        );
        console.log(xhr, status, error);
      },
    });
  }

  function setDuvida() {
    $.ajax({
      method: "POST",
      url: `http://localhost:3000/tipo_informacao`,
      data: {
        NOME_ALUNO: nome,
        STATUS: "C",
        assunto: $("#assunto").val(),
        mensagem: $("#mensagem").val(),
        mensagem_professor: $("#resposta").val(),
      },
      datatype: "json",
      success: function (data) {
        alert("Retorno enviado com sucesso.");
        window.location.href = `../Principal_trainner/index.html?id=${id}`;
        return true;
      },
      error: function (xhr, status, error) {
        alert(
          "Erro ao conectar com o servidor. Por favor tente novamente mais tarde."
        );
        console.log(xhr, status, error);
      },
    });
  }
</script>
